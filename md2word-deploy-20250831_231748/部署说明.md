# MD2Word 部署说明

## 📦 部署包内容

```
md2word-deploy-$(date +%Y%m%d_%H%M%S)/
├── frontend/          # 前端静态文件
├── backend/           # 后端API服务
└── 部署说明.md        # 本文档
```

## 🚀 宝塔面板部署步骤

### 1. 上传部署包
- 将整个部署文件夹压缩为 zip 文件
- 通过宝塔面板文件管理上传到服务器
- 解压到 `/www/wwwroot/` 目录下

### 2. 部署前端
```bash
# 进入网站根目录
cd /www/wwwroot/your-domain.com

# 复制前端文件到网站根目录
cp -r ../md2word-deploy-*/frontend/* ./

# 设置文件权限
chmod -R 755 ./
chown -R www:www ./
```

### 3. 部署后端API
```bash
# 进入后端目录
cd /www/wwwroot/md2word-deploy-*/backend

# 安装依赖
npm install

# 安装PM2（如果没有安装）
npm install -g pm2

# 停止旧进程（如果存在）
pm2 stop md2word-api

# 启动后端服务
pm2 start server.js --name md2word-api

# 设置开机自启
pm2 startup
pm2 save
```

### 4. 配置Nginx反向代理
在宝塔面板的网站设置中，添加以下反向代理配置：

```nginx
# 后端API代理
location /api/ {
    proxy_pass http://127.0.0.1:3001/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

### 5. 检查服务状态
```bash
# 检查后端服务状态
pm2 status

# 查看日志
pm2 logs md2word-api

# 重启服务（如果需要）
pm2 restart md2word-api
```

## 🔧 重要配置

### 后端配置 (config.js)
确认以下配置正确：
- OSS配置信息
- CORS允许的域名
- 服务端口（默认3001）

### 前端配置
前端已构建为生产版本，包含所有优化：
- 代码压缩和混淆
- 静态资源优化
- 路由配置

## 🆕 本次更新内容

### 主要功能更新
1. **公式转换功能优化**
   - 改进LaTeX公式渲染
   - 优化OMML转换算法
   - 修复公式在表格中的显示问题

2. **UI界面改进**
   - 修复导出按钮宽度问题
   - 优化按钮状态切换效果

3. **性能优化**
   - 改进公式处理性能
   - 优化内存使用

## 📝 验证部署

部署完成后，请验证以下功能：
1. 访问网站首页是否正常
2. Markdown编辑器是否正常工作
3. 公式渲染是否正确
4. Word文档导出是否成功

## 🆘 故障排除

### 常见问题
1. **后端API无法访问**
   - 检查PM2服务状态
   - 检查防火墙设置（开放3001端口）
   - 检查Nginx反向代理配置

2. **公式转换失败**
   - 检查后端服务日志
   - 确认依赖包安装完整

3. **静态文件无法访问**
   - 检查文件权限
   - 检查Nginx配置

如有问题，请查看PM2日志和Nginx错误日志。
