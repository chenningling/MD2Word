17:44:26.962 exportService.js:81 开始导出Word文档...
17:44:26.963 exportService.js:82 格式设置: {template: 'default', content: {…}, latin: {…}, page: {…}}
17:44:26.967 exportService.js:85 [Export] 开始处理 LaTeX 公式...
17:44:26.967 latexExportService.js:102 [LaTeX Export] 开始处理文档中的 LaTeX 公式
17:44:26.967 latexExportService.js:103 [LaTeX Export Debug] 当前时间戳: 1756547066967 缓存大小: 6
17:44:26.969 latexUtils.js:36 [LaTeX Utils] 开始提取 LaTeX 公式，文本长度: 25
17:44:26.970 latexUtils.js:78 [LaTeX Utils] 发现公式 {id: 'formula_1', type: 'inline', latex: 'E = mc^2', position: '9-19', isValid: true}
17:44:26.970 latexUtils.js:87 [LaTeX Utils] 提取完成，共发现 1 个公式
17:44:26.970 latexExportService.js:123 [LaTeX Export] 发现 1 个 LaTeX 公式
17:44:26.970 latexExportService.js:190 [LaTeX Export] 开始转换 1 个公式为 OMML
17:44:26.970 latexExportService.js:198 [LaTeX Export] 处理批次 1/1，包含 1 个公式
17:44:26.971 latexExportService.js:259 [LaTeX Export] 批次缓存统计: 1 个缓存命中, 0 个需要转换
17:44:26.971 latexExportService.js:339 [LaTeX Export] 批次转换完成 {total: 1, successful: 1, failed: 0, duration: 1}
17:44:26.971 latexExportService.js:347 [LaTeX Export] 结果顺序验证: ['1. formula_1']
17:44:26.971 latexExportService.js:220 [LaTeX Export] 所有批次处理完成，总计 1 个结果
17:44:26.972 latexExportService.js:410 [LaTeX Export] 开始在markdown中替换LaTeX公式为占位符
17:44:26.972 latexUtils.js:36 [LaTeX Utils] 开始提取 LaTeX 公式，文本长度: 25
17:44:26.972 latexUtils.js:78 [LaTeX Utils] 发现公式 {id: 'formula_1', type: 'inline', latex: 'E = mc^2', position: '9-19', isValid: true}
17:44:26.972 latexUtils.js:87 [LaTeX Utils] 提取完成，共发现 1 个公式
17:44:26.972 latexExportService.js:436 [LaTeX Export] Markdown替换检查: E = mc^2 | 找到匹配: true | 结果ID: formula_1
17:44:26.972 latexExportService.js:450 [LaTeX Export] 准备替换公式: E = mc^2 → <!--OMML_PLACEHOLDER_formula_1-->
17:44:26.972 latexExportService.js:459 [LaTeX Export] 公式替换顺序 (执行顺序，倒序): ['formula_1']
17:44:26.972 latexExportService.js:460 [LaTeX Export] 公式替换顺序 (文档中的原始顺序): ['formula_1']
17:44:26.972 latexExportService.js:468 [LaTeX Export] Markdown中公式已替换: E = mc^2 → <!--OMML_PLACEHOLDER_formula_1-->
17:44:26.972 latexExportService.js:471 [LaTeX Export] Markdown替换完成，长度: 25 → 48
17:44:26.972 latexExportService.js:154 [LaTeX Export] 处理完成 {totalFormulas: 1, successful: 1, failed: 0, totalTime: 5}
17:44:26.973 exportService.js:90 [Export] 使用处理后的markdown: 这是一个行内公式 <!--OMML_PLACEHOLDER_formula_1--> 的测试。
...
17:44:26.977 exportService.js:94 解析的Markdown tokens: [{…}, links: {…}]
17:44:26.977 exportService.js:97 [OMML Debug] 详细检查解析后的tokens:
17:44:26.977 exportService.js:99 [OMML Debug] Token 0: {type: 'paragraph', text: '这是一个行内公式 \x3C!--OMML_PLACEHOLDER_formula_1--> 的测试。', raw: '这是一个行内公式 \x3C!--OMML_PLACEHOLDER_formula_1--> 的测试。\n', hasTokens: true, tokensCount: 3}
17:44:26.978 exportService.js:110 [OMML Debug]   SubToken 0: {type: 'text', text: '这是一个行内公式 ', raw: '这是一个行内公式 '}
17:44:26.978 exportService.js:110 [OMML Debug]   SubToken 1: {type: 'html', text: '\x3C!--OMML_PLACEHOLDER_formula_1-->', raw: '\x3C!--OMML_PLACEHOLDER_formula_1-->'}
17:44:26.978 exportService.js:110 [OMML Debug]   SubToken 2: {type: 'text', text: ' 的测试。', raw: ' 的测试。'}
17:44:26.978 exportService.js:120 [Export] LaTeX 处理完成: {hasFormulas: true, formulaCount: 1, conversionTime: 5, fallbackMode: false}
17:44:26.978 exportService.js:798 预处理完成，共处理 0 张图片
17:44:26.979 exportService.js:910 处理后的tokens: [{…}]
17:44:26.979 exportService.js:192 [OMML Debug] 检查tokens中的占位符...
17:44:26.979 exportService.js:201 [OMML Debug] Token中发现占位符: ['\x3C!--OMML_PLACEHOLDER_formula_1-->'] paragraph
17:44:26.979 exportService.js:208 [OMML Debug] Token raw中发现占位符: ['\x3C!--OMML_PLACEHOLDER_formula_1-->'] paragraph
17:44:26.980 exportService.js:201 [OMML Debug] Token中发现占位符: ['\x3C!--OMML_PLACEHOLDER_formula_1-->'] html
17:44:26.980 exportService.js:208 [OMML Debug] Token raw中发现占位符: ['\x3C!--OMML_PLACEHOLDER_formula_1-->'] html
17:44:26.980 exportService.js:222 [OMML Debug] 期望在tokens中找到的占位符:
17:44:26.980 exportService.js:225 [OMML Debug] - <!--OMML_PLACEHOLDER_formula_1-->
17:44:26.980 exportService.js:1363 [Export OMML] 设置当前导出的 OMML 结果 {count: 1}
17:44:26.988 exportService.js:1370 开始解析 1 个tokens为Word文档元素
17:44:26.988 exportService.js:1371 tokens类型统计: {paragraph: 1}
17:44:26.990 exportService.js:2059 [Export OMML] Token 文本包含 OMML 标记
17:44:26.991 exportService.js:1236 [Export OMML] 处理文本中的 OMML 标记 {textLength: 33, ommlCount: 1}
17:44:26.991 exportService.js:1273 [Export OMML] OMML 格式不正确，尝试包装: <?xml version="1.0" encoding="UTF-8"?>
<m:oMath xm
processOmmlInText @ exportService.js:1273
（匿名） @ exportService.js:2060
processTokensToTextRuns @ exportService.js:1978
createParagraph @ exportService.js:1625
parseTokensToDocxElements @ exportService.js:1386
createWordDocument @ exportService.js:1212
exportToWord @ exportService.js:165
await in exportToWord
handleExport @ Header.js:185
（匿名） @ button.js:186
executeDispatch @ react-dom-client.development.js:16368
runWithFiberInDEV @ react-dom-client.development.js:1518
processDispatchQueue @ react-dom-client.development.js:16417
（匿名） @ react-dom-client.development.js:17016
batchedUpdates$1 @ react-dom-client.development.js:3262
dispatchEventForPluginEventSystem @ react-dom-client.development.js:16572
dispatchEvent @ react-dom-client.development.js:20657
dispatchDiscreteEvent @ react-dom-client.development.js:20625
17:44:26.991 exportService.js:1282 [Export OMML] 准备创建 OMML 组件: {formulaId: 'formula_1', ommlLength: 376, ommlPreview: '<m:oMath xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math"><?xml version="1.0" en'}
17:44:26.991 exportService.js:1292 [Export OMML] 生成的 Word XML: {formulaId: 'formula_1', xmlPreview: '<m:oMath xmlns:m="http://schemas.openxmlformats.or…oding="UTF-8"?>\n<m:oMath xmlns:m="http://schemas.'}
17:44:26.992 exportService.js:1301 [Export OMML] 使用占位符，稍后后处理替换: <!--OMML_PLACEHOLDER_formula_1-->
17:44:26.992 exportService.js:1304 [Export OMML] OMML 公式已添加 {formulaId: 'formula_1', latex: 'E = mc^2'}
17:44:26.992 exportService.js:1341 [Export OMML] 文本 OMML 处理完成 {processedFormulas: 1, totalElements: 1}
17:44:26.993 exportService.js:30 首行缩进计算详情: {fontSizeInPoints: 12, charCount: 2, fontFamily: '宋体', isChineseFont: true, charWidthRatio: 1, …}
17:44:26.993 exportService.js:1649 段落设置: {firstLineIndent: 2, firstLineIndentTwips: 480, paragraphSpacing: 6, spacingAfterTwips: 120, lineHeight: 1.5, …}
17:44:26.993 exportService.js:1675 创建段落：{"chosenStyleId":"paragraph-2-chars","firstLineIndent":2,"willSetIndentAtParagraphLevel":false}
17:44:26.994 exportService.js:1427 解析完成，共生成 1 个Word文档元素
17:44:26.994 exportService.js:1428 Word文档元素类型统计: {Paragraph: 1}
17:44:27.001 exportService.js:1219 样式已注入（importedStyles）：paragraph-2-chars / paragraph-4-chars / paragraph-no-indent
17:44:27.001 exportService.js:170 [Export] LaTeX 导出统计: {totalExports: 8, totalFormulas: 13, successfulConversions: 13, failedConversions: 0, cacheHits: 6, …}
17:44:27.089 exportService.js:234 [OMML Debug] 检查生成的docx中的占位符...
17:44:27.101 exportService.js:244 [OMML Debug] document.xml长度: 3396
17:44:27.101 exportService.js:249 [OMML Debug] XML中的占位符: []
17:44:27.101 exportService.js:259 [OMML Debug] 期望占位符 <!--OMML_PLACEHOLDER_formula_1-->: ❌未找到
17:44:27.101 exportService.js:260 [OMML Debug] 转义占位符 &lt;!--OMML_PLACEHOLDER_formula_1--&gt;: ✅找到
17:44:27.101 exportService.js:267 [OMML Debug] XML开头预览: <?xml version="1.0" encoding="UTF-8" standalone="yes"?><w:document mc:Ignorable="w14 w15 wp14" xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:wp14="http:/
17:44:27.107 exportService.js:288 [Document Debug] 🚀 原始Word文档包含 1 个段落
17:44:27.107 exportService.js:297 [Document Debug] 段落 1: 📊 包含占位符 - 这是一个行内公式 &lt;!--OMML_PLACEHOLDER_formula_1--&gt; 的...
17:44:27.107 exportService.js:307 [OMML Post-process Debug] 开始替换 1 个公式占位符
17:44:27.107 exportService.js:308 [OMML Post-process Debug] XML文档长度: 3396
17:44:27.107 exportService.js:313 [OMML Post-process Debug] XML中找到 0 个占位符: []
17:44:27.107 exportService.js:331 [OMML Post-process Debug] XML中占位符顺序: ['formula_1@2815']
17:44:27.108 exportService.js:348 [OMML Post-process Debug] 处理OMML结果: {id: 'formula_1', success: true, hasOmml: true, latex: 'E = mc^2', isDisplayMode: false, …}
17:44:27.108 exportService.js:362 [OMML Post-process Debug] 查找占位符: <!--OMML_PLACEHOLDER_formula_1-->
17:44:27.108 exportService.js:363 [OMML Post-process Debug] 查找转义占位符: &lt;!--OMML_PLACEHOLDER_formula_1--&gt;
17:44:27.108 exportService.js:364 [OMML Post-process Debug] XML中包含原始占位符: false
17:44:27.108 exportService.js:365 [OMML Post-process Debug] XML中包含转义占位符: true
17:44:27.108 exportService.js:380 [OMML Post-process Debug] 清理后的OMML长度: 205
17:44:27.108 exportService.js:381 [OMML Post-process Debug] 清理后的OMML预览: 
<m:oMath xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" ><m:r><m:t>E=m</m:t></m:r><m:sSup><m:e><m:r><m:t>c</m:t></m:r></m:e><m:
17:44:27.109 exportService.js:387 [OMML Post-process Debug] 查找包含占位符的段落: true
17:44:27.109 exportService.js:397 [OMML Post-process Debug] 🔍 段落是否包含其他文本内容: true
17:44:27.109 exportService.js:399 [OMML Post-process Debug] 🔍 检测到行内公式，段落包含额外文本内容
17:44:27.109 exportService.js:400 [OMML Post-process Debug] 🔍 段落文本预览: <w:p><w:pPr><w:pStyle w:val="paragraph-2-chars"/><w:spacing w:before="0" w:after="120" w:line="360" w:lineRule="auto"/><w:jc w:val="left"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="宋体" w:cs="宋体" w:eastAs...
17:44:27.109 exportService.js:417 [OMML Post-process Debug] 🔍 正则匹配的内容长度: 785
17:44:27.109 exportService.js:418 [OMML Post-process Debug] 🔍 匹配内容预览: <w:p><w:pPr><w:pStyle w:val="paragraph-2-chars"/><w:spacing w:before="0" w:after="120" w:line="360" w:lineRule="auto"/><w:jc w:val="left"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="宋体" w:cs="宋体" w:eastAs...
17:44:27.109 exportService.js:422 [OMML Post-process Debug] 🔍 匹配内容包含 1 个段落开始标签
17:44:27.109 exportService.js:434 [OMML Post-process Debug] 🔄 处理行内公式，只替换占位符本身
17:44:27.109 exportService.js:436 [OMML Post-process Debug] ✅ 行内公式占位符替换完成
17:44:27.109 exportService.js:481 [OMML Post-process Debug] ✅ 占位符 &lt;!--OMML_PLACEHOLDER_formula_1--&gt; 替换成功
17:44:27.109 exportService.js:499 [OMML Post-process Debug] 处理完成，剩余占位符: 0 []
17:44:27.110 exportService.js:502 [OMML Post-process Debug] 检查最终XML中的公式顺序...
17:44:27.110 exportService.js:504 [OMML Post-process Debug] 最终XML中包含 1 个数学公式
17:44:27.110 exportService.js:516 [OMML Post-process Debug] 公式 1: <m:oMath xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" ><m:r><m:t>E=m</m:t></...
17:44:27.110 exportService.js:524 [OMML Post-process Debug] 公式 1 提取的文本: E=mc2...
17:44:27.110 exportService.js:529 [OMML Post-process Debug] 验证公式ID和内容对应关系:
17:44:27.110 exportService.js:532 [OMML Post-process Debug] 位置 1: ID=formula_1, 期望内容=E = mc^2
17:44:27.110 exportService.js:536 [OMML Post-process Debug] 分析XML段落结构:
17:44:27.110 exportService.js:537 [OMML Post-process Debug] XML字符串长度: 3562
17:44:27.110 exportService.js:540 [OMML Post-process Debug] 找到 1 个段落
17:44:27.110 exportService.js:553 [OMML Post-process Debug] 段落 1: 📊 包含公式 1 = "E=mc2"
17:44:27.110 exportService.js:564 [OMML Post-process Debug] 段落 1: 📝 标题 1 = "这是一个行内公式  的测试。"
17:44:27.110 exportService.js:574 [OMML Post-process Debug] 段落分析完成: 共 1 个段落，1 个公式段落，1 个标题段落
17:44:27.110 exportService.js:579 [OMML Protection] OMML替换后XML中有 1 个段落
17:44:27.110 exportService.js:587 [OMML Protection] 段落 1: 📊 包含OMML公式
17:44:27.110 exportService.js:604 [OMML Protection] 在已替换OMML的XML中找到 1 个OMML需要保护
17:44:27.110 exportService.js:611 [OMML Protection] 保护OMML 1: __OMML_PROTECTED_0__ (长度: 203)
17:44:27.110 exportService.js:612 [OMML Protection] 被保护的内容预览: <m:oMath xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" ><m:r><m:t>E=m</m:t></...
17:44:27.113 exportService.js:627 [OMML Protection] XML解析完成，检查JSON结构
17:44:27.113 exportService.js:628 [OMML Protection] JSON根键: ?xml, w:document
17:44:27.113 exportService.js:636 [OMML Protection] ✅ 找到w:document
17:44:27.113 exportService.js:643 [OMML Protection] ✅ 找到w:body
17:44:27.113 exportService.js:646 [OMML Protection] 段落类型: object, 是否为数组: false
17:44:27.113 exportService.js:655 [OMML Protection] 找到单个段落对象: {"w:pPr":{"w:pStyle":{"@_w:val":"paragraph-2-chars"},"w:spacing":{"@_w:before":"0","@_w:after":"120"...
17:44:27.113 exportService.js:661 [OMML Protection] w:body的所有键: w:p, w:sectPr
17:44:27.114 exportService.js:700 [OMML Protection] XMLBuilder构建完成，准备开始恢复阶段
17:44:27.114 exportService.js:701 [OMML Protection] 构建后XML长度: 3595
17:44:27.114 exportService.js:702 [OMML Protection] 保护映射表大小: 1
17:44:27.114 exportService.js:706 [OMML Protection] XML重建后有 1 个段落
17:44:27.114 exportService.js:709 [OMML Protection] 重建段落 1: 📊 包含保护占位符
17:44:27.114 exportService.js:722 [OMML Protection] 开始恢复 1 个被保护的OMML
17:44:27.114 exportService.js:723 [OMML Protection] 恢复前XML长度: 3595
17:44:27.114 exportService.js:727 [OMML Protection] XML中是否包含保护键: true
17:44:27.114 exportService.js:735 [OMML Protection] ✅ 恢复OMML: __OMML_PROTECTED_0__ → OMML内容 (XML长度: 3595 → 3778)
17:44:27.114 exportService.js:752 [OMML Protection] 恢复后XML长度: 3778
17:44:27.115 exportService.js:753 [OMML Protection] OMML恢复完成
17:44:27.137 exportService.js:758 docx后处理完成：已写入 firstLineChars 和 OMML 公式
17:44:27.140 exportService.js:183 Word文档导出成功!
